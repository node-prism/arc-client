var u=Object.create;var o=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var l=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var y=(s,t)=>{for(var e in t)o(s,e,{get:t[e],enumerable:!0})},a=(s,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of d(t))!m.call(s,n)&&n!==e&&o(s,n,{get:()=>t[n],enumerable:!(r=h(t,n))||r.enumerable});return s};var k=(s,t,e)=>(e=s!=null?u(l(s)):{},a(t||!s||!s.__esModule?o(e,"default",{value:s,enumerable:!0}):e,s)),w=s=>a(o({},"__esModule",{value:!0}),s);var g={};y(g,{ArcClient:()=>i});module.exports=w(g);var c=require("@prsm/duplex"),p=k(require("events"),1),i=class{client;authenticated=!1;username;password;tokens;emitter;constructor(t){this.client=new c.CommandClient(t),this.username=t.username,this.password=t.password,this.emitter=new p.default}close(){this.authenticated=!1,this.client.close()}open(){this.client.connect()}async auth(){let t={username:this.username,password:this.password},e=await this.client.command(0,t);return e.error?(this.emitter.emit("autherror",e.error),!1):(this.tokens={accessToken:e.accessToken},this.authenticated=!0,this.emitter.emit("authsuccess"),!0)}async query(t){if(!this.authenticated)try{await this.auth()}catch{throw new Error("Failed to authenticate")}return t.accessToken=this.tokens.accessToken,await this.client.command(2,t)}async createUser(t,e){let r={username:t,password:e,accessToken:this.tokens.accessToken};return await this.client.command(3,r)}async removeUser(t){let e={username:t,accessToken:this.tokens.accessToken};return await this.client.command(4,e)}collectionWrapper(t){return{find:(e,r)=>this.query({collection:t,operation:"find",data:{query:e,options:r}}),insert:e=>this.query({collection:t,operation:"insert",data:{query:e}}),update:(e,r,n)=>this.query({collection:t,operation:"update",data:{query:e,operations:r,options:n}}),remove:(e,r)=>this.query({collection:t,operation:"remove",data:{query:e,options:r}}),drop:()=>this.query({collection:t,operation:"drop"})}}};0&&(module.exports={ArcClient});
